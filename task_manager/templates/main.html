<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>User Management</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #f9f9f9;
                margin: 0;
                padding: 20px;
                }
                h1 {
                    text-align: center;
                    color: #333;
                }
                form {
                    display: flex;
                    justify-content: center;
                    margin-bottom: 20px;
                }
                input[type="text"], input[type="email"] {
                    padding: 10px;
                    margin-right: 10px;
                    border: 1px solid #ccc;
                    border-radius: 4px;
                    width: 200px;
                }
                button {
                    padding: 10px 20px;
                    background-color: #28a745;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                }
                button:hover {
                    background-color: #218838;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 20px;
                }
                th, td {
                    border: 1px solid #ddd;
                    padding: 12px;
                    text-align: left;
                }
                th {
                    background-color: #f4f4f4;
                    color: #333;
                }
                tr:nth-child(even) {
                    background-color: #f9f9f9;
                }
                tr:hover {
                    background-color: #f1f1f1;
                }
                .navbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background-color: #333;
                padding: 18px 20px;
                }

                .logo {
                    font-size: 24px;
                    color: #fff;
                }

                .nav-links {
                    list-style: none;
                    display: flex;
                    margin: 0;
                    padding: 0;
                }

                .nav-links li {
                    margin: 0 15px;
                }

                .nav-links a {
                    text-decoration: none;
                    color: #fff;
                    font-size: 18px;
                    transition: color 0.3s;
                }

                .nav-links a:hover {
                    color: #ff6347; /* Tomato color for hover effect */
                }
        </style>
    </head>
    <body>
        <header>
            <nav class="navbar">
                <div class="logo">YourLogo</div>
                <ul class="nav-links">
                    <li><a href="registerUser">Users</a></li>
                    <li><a href="{% url "projects" %}">Project List</a></li>
                    <li><a href="{% url "task_management" %}">Tasks</a></li>
                </ul>
            </nav>
        </header>
        <h1>User Management</h1>

        <!-- Form to Add a New User -->
        <form id="add-user-form">
            <input type="text" id="username" placeholder="Username" required>
            <input type="email" id="email" placeholder="Email" required>
            <button type="submit">Add User</button>
        </form>

        <!-- Table to Display Users -->
        <table id="user-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                </tr>
            </thead>
            <tbody id="user-table-body">
                <!-- User rows will be inserted here -->
            </tbody>
        </table>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                fetchUsers();

                document.getElementById('add-user-form').addEventListener('submit', async (event) => {
                    event.preventDefault();
                    const username = document.getElementById('username').value;
                    const email = document.getElementById('email').value;

                    try {
                        const response = await fetch('http://127.0.0.1:8000/register/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCsrfToken(),
                            },
                            body: JSON.stringify({ username, email }),
                        });

                        if (response.ok) {
                            const data = await response.json();
                            console.log(data.message);
                            fetchUsers();  // Refresh the user list
                            document.getElementById('username').value = '';
                            document.getElementById('email').value = '';
                        } else {
                            const errorData = await response.json();
                            console.error('Failed to add user:', errorData.message);
                        }
                    } catch (error) {
                        console.error('An error occurred:', error);
                    }
                });
            });

            async function fetchUsers() {
                try {
                    const response = await fetch('http://127.0.0.1:8000/user/all');
                    if (response.ok) {
                        const users = await response.json();
                        const userTableBody = document.getElementById('user-table-body');
                        userTableBody.innerHTML = '';

                        users.forEach(user => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${user.id}</td>
                                <td>${user.username}</td>
                                <td>${user.email}</td>
                            `;
                            userTableBody.appendChild(row);
                        });
                    } else {
                        console.error('Failed to fetch users');
                    }
                } catch (error) {
                    console.error('An error occurred:', error);
                }
            }

            function getCsrfToken() {
                return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            }
        </script>
    </body>
</html>
